<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinQuest - Your Financial Garden</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        secondary: {
                            50: '#fefce8',
                            100: '#fef9c3',
                            200: '#fef08a',
                            300: '#fde047',
                            400: '#facc15',
                            500: '#eab308',
                            600: '#ca8a04',
                            700: '#a16207',
                            800: '#854d0e',
                            900: '#713f12',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        .animate-glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
            to { box-shadow: 0 0 30px rgba(34, 197, 94, 0.6); }
        }
        
        .hidden {
            display: none;
        }
        
        .page {
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-gradient bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent">
                            🌱 FinQuest
                        </h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="showPage('dashboard')" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50">
                        Dashboard
                    </button>
                    <button onclick="showPage('reminders')" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50">
                        Reminders
                    </button>
                    <button onclick="showPage('transactions')" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50">
                        Transactions
                    </button>
                    <button onclick="showPage('analytics')" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50">
                        Analytics
                    </button>
                    <button onclick="showPage('bank')" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50">
                        Bank Connect
                    </button>
                    <button onclick="showPage('simulations')" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50">
                        What-If
                    </button>
                    <button onclick="showPage('profile')" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50">
                        Profile
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Page -->
    <div id="login-page" class="page flex items-center justify-center bg-gradient-to-br from-primary-50 to-secondary-50">
        <div class="max-w-md w-full space-y-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900">Welcome to FinQuest</h2>
                <p class="mt-2 text-sm text-gray-600">Your Financial Garden Awaits</p>
            </div>
            <form class="mt-8 space-y-6" onsubmit="handleLogin(event)" id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                        <input id="email" name="email" type="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500" placeholder="akash@example.com">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        <input id="password" name="password" type="password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500" placeholder="password123">
                    </div>
                </div>
                <div>
                    <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                        Sign In
                    </button>
                </div>
                <div class="text-center">
                    <p class="text-sm text-gray-600">Real Nessie API Users:</p>
                    <div class="mt-2 space-y-1 text-xs">
                        <p><strong>Akash Mallepally:</strong> akash@example.com / password123</p>
                        <p><strong>Alice Smith:</strong> alice@example.com / password456</p>
                        <p><strong>Nikhil Bismillah:</strong> nikhil@example.com / password789</p>
                        <p><strong>Mokshitha Mandadi:</strong> mokshitha@example.com / password101</p>
                    </div>
                    <div class="mt-4 space-x-2">
                        <button type="button" onclick="quickLogin('akash@example.com', 'password123')" class="text-xs bg-blue-200 hover:bg-blue-300 px-3 py-1 rounded">
                            Login as Akash
                        </button>
                        <button type="button" onclick="quickLogin('alice@example.com', 'password456')" class="text-xs bg-green-200 hover:bg-green-300 px-3 py-1 rounded">
                            Login as Alice
                        </button>
                        <button type="button" onclick="quickLogin('nikhil@example.com', 'password789')" class="text-xs bg-purple-200 hover:bg-purple-300 px-3 py-1 rounded">
                            Login as Nikhil
                        </button>
                        <button type="button" onclick="quickLogin('mokshitha@example.com', 'password101')" class="text-xs bg-pink-200 hover:bg-pink-300 px-3 py-1 rounded">
                            Login as Mokshitha
                        </button>
                    </div>
                    <div class="mt-2 space-x-2">
                        <button type="button" onclick="testNavigation()" class="text-xs bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded">
                            Test Navigation
                        </button>
                        <button type="button" onclick="testDirectLogin()" class="text-xs bg-yellow-200 hover:bg-yellow-300 px-3 py-1 rounded">
                            Test Direct Login
                        </button>
                    </div>
                    <div class="mt-4">
                        <button type="button" onclick="showNewAccountModal()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Create New Account
                        </button>
                    </div>
                    
                    <div class="mt-3 text-center">
                        <p class="text-sm text-gray-600">Don't have a Nessie Customer ID?</p>
                        <button type="button" onclick="showNessieHelp()" class="text-sm text-blue-600 hover:text-blue-800 underline">
                            How to get one
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- New Account Modal -->
    <div id="newAccountModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Create New Account</h3>
                    <button onclick="hideNewAccountModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="newAccountForm" class="space-y-4">
                    <div>
                        <label for="newName" class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" id="newName" name="name" required 
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    
                    <div>
                        <label for="newEmail" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="newEmail" name="email" required 
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    
                    <div>
                        <label for="newPassword" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="newPassword" name="password" required 
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    
                    <div>
                        <label for="newCustomerId" class="block text-sm font-medium text-gray-700">Nessie Customer ID</label>
                        <input type="text" id="newCustomerId" name="customerId" required 
                               placeholder="e.g., 68d84b999683f20dd5196b7c"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        <p class="mt-1 text-xs text-gray-500">Enter your Nessie API customer ID</p>
                    </div>
                    
                    <div class="flex space-x-3 pt-4">
                        <button type="button" onclick="hideNewAccountModal()" 
                                class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded-md text-sm font-medium">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="flex-1 bg-primary-600 hover:bg-primary-700 text-white py-2 px-4 rounded-md text-sm font-medium">
                            Create Account
                        </button>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <p class="text-center text-sm text-gray-600 mb-3">Already have an account?</p>
                        <button type="button" onclick="hideNewAccountModal(); showLoginForm()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-md text-sm font-medium transition-colors">
                            Login Instead
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page hidden">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Financial Dashboard</h1>
                        <p id="user-welcome" class="text-sm text-gray-600 mt-1">Welcome back!</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="logout()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                            Logout
                        </button>
                        <button onclick="resetAllData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Reset All
                        </button>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">💰</span>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Total Balance</dt>
                                        <dd class="text-lg font-medium text-gray-900" id="total-balance">$12,450.00</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-secondary-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">🎯</span>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Active Goals</dt>
                                        <dd id="activeGoalsCount" class="text-lg font-medium text-gray-900">0</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">📈</span>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">6-Month Income</dt>
                                        <dd class="text-lg font-medium text-gray-900" id="monthly-income">$1,500.00</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">📉</span>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">6-Month Expenses</dt>
                                        <dd class="text-lg font-medium text-gray-900" id="monthly-expenses">$1,200.00</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Recommendations Section -->
                <div class="bg-white shadow rounded-lg p-6 mb-8">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Recommendations</h2>
                    <div id="aiRecommendationsList" class="space-y-3">
                        <!-- AI recommendations will be loaded here -->
                    </div>
                </div>

                <!-- Active Streaks and Goals Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Active Streaks Section (Left) -->
                    <div class="bg-white shadow rounded-lg p-4">
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center">
                                <span class="text-lg mr-2">💰</span>
                                <h2 class="text-base font-semibold text-gray-900">Active Streaks</h2>
                            </div>
                            <button onclick="showStrategyModal()" class="text-xs text-primary-600 hover:text-primary-700 font-medium bg-primary-50 px-2 py-1 rounded">
                                + Add
                            </button>
                        </div>
                        <div id="activeStreaksList" class="space-y-2">
                            <!-- Active streaks will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Goals Section (Right) -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-lg font-semibold text-gray-900 mb-4">Goals</h2>
                        <button onclick="showGoalModal()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg font-medium mb-4 transition-colors">
                            Set goal
                        </button>
                        <div id="goalsList" class="space-y-3">
                            <!-- Goals will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Garden Section -->
                <div class="bg-white shadow rounded-lg p-6 mb-8">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Garden</h2>
                    <div class="text-center">
                        <div class="relative inline-block mb-4">
                            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto">
                                <span class="text-4xl">🌱</span>
                            </div>
                            <div class="absolute -top-2 -right-2 bg-blue-100 text-blue-600 text-xs font-bold px-2 py-1 rounded-full">
                                +3
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Your financial garden is growing!</p>
                        <button onclick="showSpendingVisualization()" class="w-full bg-primary-600 hover:bg-primary-700 text-white py-3 rounded-lg font-medium transition-colors">
                            Visualize spending
                        </button>
                    </div>
                </div>
                
                <!-- Recent Transactions -->
                <div class="bg-white shadow rounded-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Recent Transactions</h2>
                    <div class="space-y-3" id="recent-transactions-container">
                        <div class="text-center py-4 text-gray-500">
                            <p class="text-sm">Loading transactions...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Goals Page (Hidden) -->
    <div id="goals-page" class="page hidden" style="display: none !important;">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-900">Financial Goals</h1>
                    <button class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                        + New Goal
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Emergency Fund</h3>
                            <span class="text-sm text-gray-500">50%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                            <div class="bg-primary-600 h-3 rounded-full" style="width: 50%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>$2,500 saved</span>
                            <span>$5,000 target</span>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-500">Target Date: Dec 2024</p>
                        </div>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Vacation Fund</h3>
                            <span class="text-sm text-gray-500">40%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                            <div class="bg-secondary-600 h-3 rounded-full" style="width: 40%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>$800 saved</span>
                            <span>$2,000 target</span>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-500">Target Date: Mar 2025</p>
                        </div>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">New Laptop</h3>
                            <span class="text-sm text-gray-500">80%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                            <div class="bg-green-600 h-3 rounded-full" style="width: 80%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>$1,200 saved</span>
                            <span>$1,500 target</span>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-500">Target Date: Oct 2024</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reminders Page -->
    <div id="reminders-page" class="page hidden">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-900">💳 Credit Card Reminders</h1>
                    <button onclick="showReminderModal()" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                        + Add Reminder
                    </button>
                </div>
                
                <!-- Reminders List -->
                <div id="remindersList" class="space-y-4">
                    <!-- Reminders will be loaded here -->
                </div>
                
                <!-- Empty State -->
                <div id="emptyRemindersState" class="text-center py-12 hidden">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">⏰</span>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">No reminders set</h3>
                    <p class="text-gray-500 mb-4">Add credit card bill reminders to never miss a payment</p>
                    <button onclick="showReminderModal()" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                        Add Your First Reminder
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transactions Page -->
    <div id="transactions-page" class="page hidden">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Transactions</h1>
                
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-medium text-gray-900">Recent Transactions</h2>
                    </div>
                    <div id="transactionsList" class="divide-y divide-gray-200">
                        <!-- Transactions will be loaded dynamically here -->
                        <div class="text-center py-8 text-gray-500">
                            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">💳</span>
                            </div>
                            <p class="text-sm">Loading transactions...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Page -->
    <div id="analytics-page" class="page hidden">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Financial Analytics</h1>
                
                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-6 h-6 bg-green-100 rounded flex items-center justify-center">
                                    <span class="text-green-600 text-xs font-semibold">$</span>
                                </div>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-500">Total Spending</p>
                                <p class="text-xl font-semibold text-gray-900" id="analytics-total-spending">Loading...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-6 h-6 bg-blue-100 rounded flex items-center justify-center">
                                    <span class="text-blue-600 text-xs font-semibold">%</span>
                                </div>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-500">Savings Rate</p>
                                <p class="text-xl font-semibold text-gray-900" id="analytics-savings-rate">Loading...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-6 h-6 bg-yellow-100 rounded flex items-center justify-center">
                                    <span class="text-yellow-600 text-xs">↑</span>
                                </div>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-500">Top Category</p>
                                <p class="text-xl font-semibold text-gray-900" id="analytics-top-category">Loading...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-6 h-6 bg-purple-100 rounded flex items-center justify-center">
                                    <span class="text-purple-600 text-xs">●</span>
                                </div>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-500">Goals Progress</p>
                                <p class="text-xl font-semibold text-gray-900" id="analytics-goals-progress">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Spending Chart -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-lg font-semibold text-gray-900 mb-4">Spending by Category</h2>
                        <div class="h-64">
                            <canvas id="spendingChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Monthly Trends -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-lg font-semibold text-gray-900 mb-4">Monthly Trends</h2>
                        <div class="space-y-4" id="monthly-trends">
                            <div class="flex justify-between items-center py-2">
                                <span class="text-sm text-gray-700">Income</span>
                                <div class="flex items-center">
                                    <span class="text-sm font-medium text-green-600 mr-2" id="trend-income">Loading...</span>
                                    <span class="text-xs text-green-600" id="trend-income-change">+0%</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center py-2">
                                <span class="text-sm text-gray-700">Expenses</span>
                                <div class="flex items-center">
                                    <span class="text-sm font-medium text-red-600 mr-2" id="trend-expenses">Loading...</span>
                                    <span class="text-xs text-red-600" id="trend-expenses-change">+0%</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center py-2">
                                <span class="text-sm text-gray-700">Savings</span>
                                <div class="flex items-center">
                                    <span class="text-sm font-medium text-primary-600 mr-2" id="trend-savings">Loading...</span>
                                    <span class="text-xs text-green-600" id="trend-savings-change">+0%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Trend Chart -->
                        <div class="mt-6">
                            <canvas id="trendChart" height="120"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- AI-Powered Financial Product Recommendations -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 shadow rounded-lg p-6 mb-8">
                    <div class="flex items-center mb-4">
                        <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mr-3">
                            <span class="text-white text-sm">🤖</span>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900">AI-Powered Financial Recommendations</h2>
                    </div>
                    
                    <div id="aiRecommendations" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Recommendations will be loaded here -->
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button onclick="generateRecommendations()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-md text-sm font-medium">
                            🔄 Generate New Recommendations
                        </button>
                    </div>
                </div>
                
                <!-- Spending Insights -->
                <div class="bg-white shadow rounded-lg p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Spending Insights</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="font-medium text-gray-900 mb-2">Top Spending Categories</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-primary-500 rounded-full mr-3"></div>
                                        <span class="text-sm text-gray-700">Food & Dining</span>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-sm font-medium text-gray-900">$300.00</span>
                                        <span class="text-xs text-gray-500 ml-2">25%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                        <span class="text-sm text-gray-700">Grocery</span>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-sm font-medium text-gray-900">$250.00</span>
                                        <span class="text-xs text-gray-500 ml-2">21%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                        <span class="text-sm text-gray-700">Shopping</span>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-sm font-medium text-gray-900">$200.00</span>
                                        <span class="text-xs text-gray-500 ml-2">17%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="font-medium text-gray-900 mb-2">Spending Patterns</h3>
                            <div class="space-y-3">
                                <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                                    <div class="flex items-center">
                                        <span class="text-green-600 text-sm mr-2">✓</span>
                                        <span class="text-sm text-green-800">You're saving 20% of your income</span>
                                    </div>
                                </div>
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                    <div class="flex items-center">
                                        <span class="text-yellow-600 text-sm mr-2">⚠</span>
                                        <span class="text-sm text-yellow-800">Dining expenses increased 15% this month</span>
                                    </div>
                                </div>
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                    <div class="flex items-center">
                                        <span class="text-blue-600 text-sm mr-2">💡</span>
                                        <span class="text-sm text-blue-800">Consider meal planning to reduce dining costs</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bank Connection Page -->
    <div id="bank-page" class="page hidden">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Connect Your Bank</h1>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Link Your Account</h2>
                        <p class="text-gray-600 mb-6">Securely connect your bank account to get real-time financial insights and automated transaction categorization.</p>
                        
                        <div class="space-y-4">
                            <div class="flex items-center p-4 border border-gray-200 rounded-lg">
                                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                    <span class="text-blue-600 text-xl">🏦</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">Chase Bank</h3>
                                    <p class="text-sm text-gray-500">Checking Account •••• 1234</p>
                                </div>
                                <button class="ml-auto bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm">
                                    Connect
                                </button>
                            </div>
                            
                            <div class="flex items-center p-4 border border-gray-200 rounded-lg">
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
                                    <span class="text-green-600 text-xl">💳</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">Wells Fargo</h3>
                                    <p class="text-sm text-gray-500">Savings Account •••• 5678</p>
                                </div>
                                <button class="ml-auto bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm">
                                    Connect
                                </button>
                            </div>
                        </div>
                        
                        <button class="w-full mt-6 bg-secondary-600 hover:bg-secondary-700 text-white py-3 rounded-md font-medium">
                            + Add New Bank Account
                        </button>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Security & Privacy</h2>
                        <div class="space-y-4">
                            <div class="flex items-start">
                                <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                                    <span class="text-green-600 text-sm">✓</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">Bank-Level Security</h3>
                                    <p class="text-sm text-gray-600">256-bit SSL encryption protects your data</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start">
                                <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                                    <span class="text-green-600 text-sm">✓</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">Read-Only Access</h3>
                                    <p class="text-sm text-gray-600">We can only view your transactions, never move money</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start">
                                <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                                    <span class="text-green-600 text-sm">✓</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">FDIC Insured</h3>
                                    <p class="text-sm text-gray-600">Your accounts remain FDIC insured up to $250,000</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- What-If Simulations Page -->
    <div id="simulations-page" class="page hidden">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">What-If Financial Simulations</h1>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Scenario Builder</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Income Change</label>
                                <input type="range" min="-1000" max="2000" value="0" class="w-full" id="incomeSlider">
                                <div class="flex justify-between text-sm text-gray-500">
                                    <span>-$1,000</span>
                                    <span id="incomeValue">$0</span>
                                    <span>+$2,000</span>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Expense Change</label>
                                <input type="range" min="-500" max="1000" value="0" class="w-full" id="expenseSlider">
                                <div class="flex justify-between text-sm text-gray-500">
                                    <span>-$500</span>
                                    <span id="expenseValue">$0</span>
                                    <span>+$1,000</span>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Investment Return Rate</label>
                                <input type="range" min="0" max="15" value="7" class="w-full" id="returnSlider">
                                <div class="flex justify-between text-sm text-gray-500">
                                    <span>0%</span>
                                    <span id="returnValue">7%</span>
                                    <span>15%</span>
                                </div>
                            </div>
                            
                            <button onclick="runSimulation()" class="w-full bg-primary-600 hover:bg-primary-700 text-white py-3 rounded-md font-medium">
                                Run Simulation
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Simulation Results</h2>
                        <div id="simulationResults" class="space-y-4">
                            <div class="text-center text-gray-500 py-8">
                                <span class="text-4xl mb-2 block">🔮</span>
                                <p>Run a simulation to see your financial future!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pre-built Scenarios -->
                <div class="mt-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Quick Scenarios</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-r from-green-50 to-green-100 border border-green-200 rounded-lg p-4 cursor-pointer hover:shadow-md transition-shadow" onclick="loadScenario('promotion')">
                            <h3 class="font-semibold text-gray-900 mb-2">🎉 Promotion Scenario</h3>
                            <p class="text-sm text-gray-600 mb-3">What if you got a 20% raise?</p>
                            <div class="text-xs text-gray-500">
                                <div>Income: +$700/month</div>
                                <div>Timeline: 1 year</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4 cursor-pointer hover:shadow-md transition-shadow" onclick="loadScenario('emergency')">
                            <h3 class="font-semibold text-gray-900 mb-2">🚨 Emergency Fund</h3>
                            <p class="text-sm text-gray-600 mb-3">Build 6-month emergency fund</p>
                            <div class="text-xs text-gray-500">
                                <div>Target: $15,000</div>
                                <div>Timeline: 18 months</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-50 to-purple-100 border border-purple-200 rounded-lg p-4 cursor-pointer hover:shadow-md transition-shadow" onclick="loadScenario('retirement')">
                            <h3 class="font-semibold text-gray-900 mb-2">🏖️ Early Retirement</h3>
                            <p class="text-sm text-gray-600 mb-3">Retire at 55 with $1M</p>
                            <div class="text-xs text-gray-500">
                                <div>Target: $1,000,000</div>
                                <div>Timeline: 25 years</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div id="profile-page" class="page hidden">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Profile</h1>
                
                <div class="bg-white shadow rounded-lg p-6">
                    <div class="flex items-center mb-6">
                        <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mr-4">
                            <span class="text-primary-600 text-2xl">👤</span>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900">Demo User</h2>
                            <p class="text-gray-500">demo@finquest.app</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" value="Demo User" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" value="demo@finquest.app" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                            <input type="tel" value="+1 (555) 123-4567" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                            <input type="date" value="1990-01-01" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Goal Creation Modal -->
    <div id="goalModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Create New Goal</h3>
                <form id="goalForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Goal Title</label>
                        <input type="text" id="oldGoalTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <input type="text" id="oldGoalDescription" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Target Amount ($)</label>
                        <input type="number" id="oldGoalAmount" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Target Date</label>
                        <input type="date" id="oldGoalDate" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                        <select id="oldGoalCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                            <option value="emergency_fund">Emergency Fund</option>
                            <option value="vacation">Vacation</option>
                            <option value="electronics">Electronics</option>
                            <option value="education">Education</option>
                            <option value="home">Home</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="hideGoalModal()" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                            Create Goal
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

        <!-- What-If Modal -->
        <div id="whatIfModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                    <div class="flex items-center justify-between p-6 border-b border-gray-200">
                        <h3 class="text-xl font-semibold text-gray-900">What-If Analysis</h3>
                        <button onclick="hideWhatIfModal()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6">
                        <div id="whatIfContent">
                            <!-- What-if results will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Goal Trajectory Modal -->
        <div id="goalTrajectoryModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                    <div class="flex items-center justify-between p-6 border-b border-gray-200">
                        <h3 class="text-xl font-semibold text-gray-900" id="trajectoryModalTitle">Goal Trajectory</h3>
                        <button onclick="hideGoalTrajectoryModal()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6">
                        <div class="h-96 w-full">
                            <canvas id="goalTrajectoryChartModal"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Goal Creation Modal - Step 1 -->
    <div id="goalCreationModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                <div class="flex items-center justify-between mb-6 p-6 border-b border-gray-200">
                    <div class="flex items-center">
                        <button onclick="hideGoalCreationModal()" class="mr-4 text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <div>
                            <div class="text-sm text-gray-500 text-center" id="stepIndicator">Step 1/3</div>
                            <h3 class="text-2xl font-bold text-gray-900" id="stepTitle">Set Your Goal</h3>
                        </div>
                    </div>
                    <div class="w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center">
                        <span class="text-pink-600 text-sm">🎯</span>
                    </div>
                </div>
                
                <div class="flex-1 overflow-y-auto p-6">

                <!-- Step 1: Goal Details -->
                <div id="step1Content" class="space-y-6">
                    <form id="goalCreationForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Goal Title</label>
                            <input type="text" id="goalTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500" placeholder="e.g., Europe Trip 2025">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <input type="text" id="goalDescription" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500" placeholder="e.g., Save for a 2-week trip to Europe">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Target Amount ($)</label>
                                <input type="number" id="goalAmount" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500" placeholder="5000">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Target Date</label>
                                <input type="date" id="goalDate" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                            <select id="goalCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                                <option value="travel">Travel</option>
                                <option value="emergency_fund">Emergency Fund</option>
                                <option value="electronics">Electronics</option>
                                <option value="education">Education</option>
                                <option value="home">Home</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </form>
                </div>

                <!-- Step 2: Streak Suggestions -->
                <div id="step2Content" class="space-y-6 hidden">
                    <div class="text-center mb-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-2">Choose Saving Strategies</h4>
                        <p class="text-gray-600">Select streaks that will help you reach your goal faster</p>
                    </div>
                    
                    <div id="streakSuggestions" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
                        <!-- Streak suggestions will be loaded here -->
                    </div>
                </div>

                <!-- Step 3: Goal Preview -->
                <div id="step3Content" class="space-y-6 hidden">
                    <div class="text-center mb-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-2">Goal Preview</h4>
                        <p class="text-gray-600">Review your goal and selected streaks</p>
                    </div>
                    
                    <div id="goalPreview" class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6">
                        <!-- Goal preview will be loaded here -->
                    </div>
                </div>

                </div>

                <!-- Action Buttons -->
                <div class="border-t border-gray-200 p-6">
                    <div class="flex justify-between">
                        <button onclick="previousStep()" id="prevButton" class="px-6 py-3 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors hidden">
                            Previous
                        </button>
                        <div class="flex space-x-3 ml-auto">
                            <button onclick="hideGoalCreationModal()" class="px-6 py-3 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                Cancel
                            </button>
                            <button onclick="nextStep()" id="nextButton" class="px-8 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-semibold">
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reminder Modal -->
    <div id="reminderModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">💳 Add Credit Card Reminder</h3>
                    <button onclick="hideReminderModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="reminderForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Credit Card Name</label>
                        <input type="text" id="reminderCardName" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500" 
                               placeholder="e.g., Chase Sapphire Preferred">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Due Date (Day of Month)</label>
                        <select id="reminderDueDate" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                            <option value="">Select day</option>
                            <option value="1">1st</option>
                            <option value="2">2nd</option>
                            <option value="3">3rd</option>
                            <option value="4">4th</option>
                            <option value="5">5th</option>
                            <option value="6">6th</option>
                            <option value="7">7th</option>
                            <option value="8">8th</option>
                            <option value="9">9th</option>
                            <option value="10">10th</option>
                            <option value="11">11th</option>
                            <option value="12">12th</option>
                            <option value="13">13th</option>
                            <option value="14">14th</option>
                            <option value="15">15th</option>
                            <option value="16">16th</option>
                            <option value="17">17th</option>
                            <option value="18">18th</option>
                            <option value="19">19th</option>
                            <option value="20">20th</option>
                            <option value="21">21st</option>
                            <option value="22">22nd</option>
                            <option value="23">23rd</option>
                            <option value="24">24th</option>
                            <option value="25">25th</option>
                            <option value="26">26th</option>
                            <option value="27">27th</option>
                            <option value="28">28th</option>
                            <option value="29">29th</option>
                            <option value="30">30th</option>
                            <option value="31">31st</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Reminder Time</label>
                        <select id="reminderTime" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                            <option value="09:00">9:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="13:00">1:00 PM</option>
                            <option value="14:00">2:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="16:00">4:00 PM</option>
                            <option value="17:00">5:00 PM</option>
                            <option value="18:00">6:00 PM</option>
                            <option value="19:00">7:00 PM</option>
                            <option value="20:00">8:00 PM</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Reminder Type</label>
                        <select id="reminderType" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                            <option value="email">Email Reminder</option>
                            <option value="browser">Browser Notification</option>
                            <option value="both">Both Email & Browser</option>
                        </select>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="hideReminderModal()" 
                                class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                            Add Reminder
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE_URL = 'http://localhost:5001';
        
        // Current user session
        let currentUser = null;

        // Authentication functions
        async function login(email, password) {
            try {
                console.log('🔐 Attempting login with:', email);
                
                // Show loading state
                const loginButton = document.querySelector('button[type="submit"]');
                if (loginButton) {
                    loginButton.disabled = true;
                    loginButton.textContent = 'Signing In...';
                }
                
                const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                console.log('📡 Login response status:', response.status);
                const data = await response.json();
                console.log('📊 Login response data:', data);
                
                if (data.success) {
                    console.log('✅ Login successful, setting user:', data.user);
                    currentUser = data.user;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    console.log('💾 User saved to localStorage');
                    
                    // Show success message
                    console.log('🎯 Attempting to show dashboard page...');
                    showPage('dashboard');
                    
                    // Load dashboard data
                    console.log('📊 Attempting to load dashboard...');
                    await loadDashboard();
                    console.log('✅ Dashboard loaded successfully');
                    
                    // Force show dashboard as fallback
                    setTimeout(() => {
                        const dashboardPage = document.getElementById('dashboard-page');
                        const loginPage = document.getElementById('login-page');
                        if (dashboardPage && loginPage) {
                            loginPage.classList.add('hidden');
                            dashboardPage.classList.remove('hidden');
                            console.log('🔄 Forced dashboard display');
                        }
                    }, 100);
                    
                    return true;
                } else {
                    console.error('❌ Login failed:', data.message);
                    alert(data.message || 'Login failed');
                    return false;
                }
            } catch (error) {
                console.error('💥 Login error:', error);
                alert('Login failed. Please check your connection and try again.');
                return false;
            } finally {
                // Reset button state
                const loginButton = document.querySelector('button[type="submit"]');
                if (loginButton) {
                    loginButton.disabled = false;
                    loginButton.textContent = 'Sign In';
                }
            }
        }

        async function logout() {
            try {
                await fetch(`${API_BASE_URL}/api/auth/logout`, {
                    method: 'POST'
                });
                
                currentUser = null;
                localStorage.removeItem('currentUser');
                showPage('login');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        async function checkAuth() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/auth/current-user`);
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    return true;
                } else {
                    currentUser = null;
                    return false;
                }
            } catch (error) {
                console.error('Auth check error:', error);
                currentUser = null;
                return false;
            }
        }

        // Handle login form submission
        async function handleLogin(event) {
            console.log('📝 Login form submitted');
            event.preventDefault();
            
            try {
                const formData = new FormData(event.target);
                const email = formData.get('email');
                const password = formData.get('password');
                
                console.log('📊 Form data extracted:', { email, password: password ? '***' : 'empty' });
                
                if (!email || !password) {
                    console.error('❌ Missing email or password');
                    alert('Please fill in both email and password');
                    return;
                }
                
                console.log('🔐 Calling login function with email and password...');
                const result = await login(email, password);
                console.log('📊 Login result:', result);
            } catch (error) {
                console.error('💥 Form submission error:', error);
                alert('Login failed: ' + error.message);
            }
        }

        // Quick login function for testing different users
        async function quickLogin(email, password) {
            console.log('🚀 Quick login for:', email);
            
            try {
                // Fill the form fields
                const emailField = document.getElementById('email');
                const passwordField = document.getElementById('password');
                
                if (emailField && passwordField) {
                    emailField.value = email;
                    passwordField.value = password;
                    console.log('📝 Form fields filled:', { email, password: '***' });
                } else {
                    console.error('❌ Form fields not found');
                    return;
                }
                
                // Call the login function
                console.log('🔐 Calling login function...');
                const result = await login(email, password);
                console.log('📊 Login result:', result);
            } catch (error) {
                console.error('💥 Quick login error:', error);
                alert('Quick login failed: ' + error.message);
            }
        }

        // Test direct login function
        async function testDirectLogin() {
            console.log('🧪 Testing direct login...');
            
            try {
                const result = await login('akash@example.com', 'password123');
                console.log('📊 Direct login result:', result);
                if (result) {
                    console.log('✅ Direct login successful');
                } else {
                    console.log('❌ Direct login failed');
                }
            } catch (error) {
                console.error('💥 Direct login error:', error);
            }
        }

        // New Account Modal Functions
        function showNewAccountModal() {
            console.log('📝 Showing new account modal');
            const modal = document.getElementById('newAccountModal');
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function hideNewAccountModal() {
            console.log('❌ Hiding new account modal');
            const modal = document.getElementById('newAccountModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        // Handle new account form submission
        async function handleNewAccount(event) {
            event.preventDefault();
            console.log('📝 New account form submitted');
            
            try {
                const formData = new FormData(event.target);
                const name = formData.get('name');
                const email = formData.get('email');
                const password = formData.get('password');
                const customerId = formData.get('customerId');
                
                console.log('📊 New account data:', { name, email, password: '***', customerId });
                
                if (!name || !email || !password || !customerId) {
                    alert('Please fill in all fields');
                    return;
                }
                
                // Validate customer ID format
                if (!customerId.match(/^[a-f0-9]{24}$/)) {
                    alert('Please enter a valid Nessie Customer ID (24 character hex string)');
                    return;
                }
                
                console.log('🔐 Creating new account...');
                const result = await createNewAccount(name, email, password, customerId);
                
                if (result.success) {
                    console.log('✅ Account created successfully');
                    alert('Account created successfully! You can now login.');
                    hideNewAccountModal();
                    // Clear form
                    event.target.reset();
                } else {
                    console.log('❌ Account creation failed:', result.message);
                    alert('Account creation failed: ' + result.message);
                }
            } catch (error) {
                console.error('💥 New account error:', error);
                alert('Account creation failed: ' + error.message);
            }
        }

        // Create new account function
        async function createNewAccount(name, email, password, customerId) {
            try {
                console.log('🚀 Creating new account for:', email);
                
                const response = await fetch(`${API_BASE_URL}/api/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        email: email,
                        password: password,
                        customerId: customerId
                    })
                });
                
                console.log('📡 Registration response status:', response.status);
                const data = await response.json();
                console.log('📊 Registration response data:', data);
                
                return data;
            } catch (error) {
                console.error('💥 Registration error:', error);
                return { success: false, message: 'Network error: ' + error.message };
            }
        }

        // Show login form (switch from new account modal)
        function showLoginForm() {
            console.log('🔄 Switching to login form');
            // The login form is already visible, just ensure new account modal is hidden
            hideNewAccountModal();
        }

        // Show Nessie help modal
        function showNessieHelp() {
            console.log('❓ Showing Nessie help');
            alert(`To get a Nessie Customer ID:

1. Visit: http://api.nessieisreal.com/
2. Use the API key: 853c3a59c190f86eefd20d854b65e96a
3. Create a new customer using POST /customers
4. Copy the customer ID from the response

Or use one of these existing customer IDs:
• 68d84b999683f20dd5196b7c (Akash)
• 68d840da9683f20dd5196aca (Alice) 
• 68d84bc09683f20dd5196b7e (Nikhil)
• 68d84bc99683f20dd5196b7f (Mokshitha)
• 68d85f499683f20dd5196e26 (Nikhil Billa)`);
        }

        // Test navigation function
        async function testNavigation() {
            console.log('🧪 Testing navigation...');
            
            // Set up a test user for demonstration
            if (!currentUser) {
                currentUser = {
                    id: 'user1',
                    email: 'akash@example.com',
                    name: 'Akash Mallepally',
                    customerId: '68d84b999683f20dd5196b7c'
                };
                console.log('👤 Set up test user:', currentUser);
            }
            
            console.log('👤 Current user before navigation:', currentUser);
            showPage('dashboard');
            
            // Load dashboard data for testing
            console.log('📊 Loading dashboard data for test...');
            try {
                await loadDashboard();
                console.log('✅ Dashboard loaded successfully');
            } catch (error) {
                console.error('💥 Error loading dashboard:', error);
            }
        }

        // Enhanced navigation system
        function showPage(pageId) {
            console.log('Showing page:', pageId);
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.add('hidden');
                console.log('Hiding page:', page.id);
            });
            
            // Show selected page
            const selectedPage = document.getElementById(pageId + '-page');
            if (selectedPage) {
                selectedPage.classList.remove('hidden');
                console.log('Showing page:', selectedPage.id);
            } else {
                console.error('Page not found:', pageId + '-page');
            }
            
            // Update navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('bg-primary-50', 'text-primary-600'));
            
            // Add active class to clicked link
            if (event && event.target) {
                event.target.classList.add('bg-primary-50', 'text-primary-600');
            }
            
            // Load page-specific data
            if (pageId === 'dashboard') {
                loadDashboard();
            } else if (pageId === 'analytics') {
                console.log('📈 Loading analytics for user:', currentUser?.name || 'Unknown');
                // Small delay to ensure page is visible
                setTimeout(() => {
                    loadAnalytics();
                }, 100);
            } else if (pageId === 'simulations') {
                initializeSimulations();
            } else if (pageId === 'reminders') {
                loadReminders();
            } else if (pageId === 'transactions') {
                loadTransactionsPage();
            }
        }

        // Load dashboard with AI recommendations
        async function loadDashboard() {
            console.log('🏠 loadDashboard() called for user:', currentUser?.name || 'Unknown');
            
            // Update user welcome message
            if (currentUser) {
                const welcomeElement = document.getElementById('user-welcome');
                if (welcomeElement) {
                    welcomeElement.textContent = `Welcome back, ${currentUser.name}!`;
                    console.log('👋 Updated welcome message for:', currentUser.name);
                }
            } else {
                console.error('❌ No current user found in loadDashboard()');
                return;
            }
            
            try {
                console.log('📊 Loading dashboard stats...');
                await loadDashboardStats();
                console.log('✅ Dashboard stats loaded');
                
                console.log('🤖 Loading AI recommendations...');
                await loadAIRecommendations();
                console.log('✅ AI recommendations loaded');
                
                console.log('🎯 Loading goals...');
                await loadGoals();
                console.log('✅ Goals loaded');
                
                console.log('🔥 Loading streaks...');
                await loadStreaks();
                console.log('✅ Streaks loaded');
                
                console.log('🎉 Dashboard loading complete for', currentUser.name);
            } catch (error) {
                console.error('💥 Error loading dashboard:', error);
                alert('Error loading dashboard data. Please refresh the page.');
            }
        }

        // Load dashboard stats from API
        async function loadDashboardStats() {
            try {
                console.log('📊 Loading dashboard stats for user:', currentUser?.name || 'Unknown');
                const response = await fetch(`${API_BASE_URL}/api/analytics/dashboard-data`);
                console.log('📡 Dashboard stats API response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('📊 Dashboard stats data received:', data);
                
                // Update total balance (using net amount from financial summary)
                const balanceElement = document.getElementById('total-balance');
                if (balanceElement && data.financial_summary?.net_amount !== undefined) {
                    balanceElement.textContent = `$${data.financial_summary.net_amount.toFixed(2)}`;
                    console.log('💰 Updated total balance:', data.financial_summary.net_amount);
                }
                
                // Update monthly income
                const incomeElement = document.getElementById('monthly-income');
                if (incomeElement && data.financial_summary?.total_income_6_months !== undefined) {
                    incomeElement.textContent = `$${data.financial_summary.total_income_6_months.toFixed(2)}`;
                    console.log('💵 Updated monthly income:', data.financial_summary.total_income_6_months);
                }
                
                // Update monthly expenses
                const expensesElement = document.getElementById('monthly-expenses');
                if (expensesElement && data.financial_summary?.total_spent_6_months !== undefined) {
                    expensesElement.textContent = `$${data.financial_summary.total_spent_6_months.toFixed(2)}`;
                    console.log('💸 Updated monthly expenses:', data.financial_summary.total_spent_6_months);
                }
                
                // Update savings rate if available
                if (data.financial_summary?.savings_rate !== undefined) {
                    console.log('💾 Savings rate:', data.financial_summary.savings_rate + '%');
                }
                
                // Update recent transactions
                if (data.recent_activity?.recent_transactions) {
                    updateRecentTransactions(data.recent_activity.recent_transactions);
                }
                
                console.log('✅ Dashboard stats updated successfully');
            } catch (error) {
                console.error('💥 Error loading dashboard stats:', error);
                // Don't show alert for stats error, just log it
            }
        }

        // Update recent transactions in dashboard
        function updateRecentTransactions(transactions) {
            const container = document.getElementById('recent-transactions-container');
            if (!container) return;
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <p class="text-sm">No recent transactions</p>
                    </div>
                `;
                return;
            }
            
            // Show only the first 5 transactions
            const recentTransactions = transactions.slice(0, 5);
            
            container.innerHTML = recentTransactions.map(transaction => {
                const amount = Math.abs(transaction.amount);
                const isDebit = transaction.type === 'debit';
                const amountClass = isDebit ? 'text-red-600' : 'text-green-600';
                const amountPrefix = isDebit ? '-' : '+';
                
                // Get category icon
                const categoryIcons = {
                    'income': '💰',
                    'food_dining': '🍔',
                    'grocery': '🛒',
                    'shopping': '🛍️',
                    'entertainment': '🎬',
                    'travel': '✈️',
                    'transportation': '🚗',
                    'utilities': '⚡',
                    'health_fitness': '💊',
                    'subscriptions': '📱',
                    'housing': '🏠',
                    'movies': '🎭',
                    'misc': '💰'
                };
                
                const icon = categoryIcons[transaction.category] || '💰';
                const date = new Date(transaction.date).toLocaleDateString();
                
                return `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mr-3">
                                <span class="text-primary-600 text-sm">${icon}</span>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">${transaction.description}</p>
                                <p class="text-xs text-gray-500">${date}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium ${amountClass}">${amountPrefix}$${amount.toFixed(2)}</p>
                            <p class="text-xs text-gray-500 capitalize">${transaction.category.replace('_', ' ')}</p>
                        </div>
                    </div>
                `;
            }).join('');
            
            console.log('✅ Recent transactions updated:', recentTransactions.length, 'transactions');
        }

        // Load transactions page
        async function loadTransactionsPage() {
            try {
                console.log('💳 Loading transactions for user:', currentUser?.name || 'Unknown');
                const response = await fetch(`${API_BASE_URL}/api/transactions`);
                console.log('📡 Transactions API response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const transactions = await response.json();
                console.log('📊 Transactions data received:', transactions.length, 'transactions');
                
                const container = document.getElementById('transactionsList');
                if (container) {
                    // Sort transactions by date (newest first)
                    const sortedTransactions = transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    if (sortedTransactions.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-8 text-gray-500">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-2xl">💳</span>
                                </div>
                                <p class="text-sm">No transactions found</p>
                                <p class="text-xs text-gray-400">Your transaction history will appear here</p>
                            </div>
                        `;
                    } else {
                        container.innerHTML = sortedTransactions.map(transaction => `
                            <div class="border border-gray-200 rounded-lg p-4 mb-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 ${transaction.type === 'credit' ? 'bg-green-100' : 'bg-red-100'} rounded-full flex items-center justify-center mr-3">
                                            <span class="text-lg">${getCategoryIcon(transaction.category)}</span>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900 text-sm">${transaction.description}</h3>
                                            <p class="text-xs text-gray-500">${new Date(transaction.date).toLocaleDateString()}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-semibold ${transaction.type === 'credit' ? 'text-green-600' : 'text-red-600'}">
                                            ${transaction.type === 'credit' ? '+' : '-'}$${Math.abs(transaction.amount).toFixed(2)}
                                        </div>
                                        <div class="text-xs text-gray-500 capitalize">${transaction.category.replace('_', ' ')}</div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                }
                
                // Update transaction summary
                const totalIncome = transactions.filter(t => t.type === 'credit').reduce((sum, t) => sum + t.amount, 0);
                const totalExpenses = Math.abs(transactions.filter(t => t.type === 'debit').reduce((sum, t) => sum + t.amount, 0));
                const netAmount = totalIncome - totalExpenses;
                
                // Update summary cards
                const incomeElement = document.getElementById('totalIncome');
                const expensesElement = document.getElementById('totalExpenses');
                const netElement = document.getElementById('netAmount');
                
                if (incomeElement) incomeElement.textContent = `$${totalIncome.toFixed(2)}`;
                if (expensesElement) expensesElement.textContent = `$${totalExpenses.toFixed(2)}`;
                if (netElement) {
                    netElement.textContent = `$${netAmount.toFixed(2)}`;
                    netElement.className = `text-lg font-bold ${netAmount >= 0 ? 'text-green-600' : 'text-red-600'}`;
                }
                
            } catch (error) {
                console.error('Error loading transactions:', error);
                const container = document.getElementById('transactionsList');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-red-500">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">⚠️</span>
                            </div>
                            <p class="text-sm">Error loading transactions</p>
                            <p class="text-xs text-gray-400">Please try again later</p>
                        </div>
                    `;
                }
            }
        }

        // Load AI recommendations from Gemini
        async function loadAIRecommendations() {
            try {
                console.log('🤖 Loading AI recommendations for user:', currentUser?.name || 'Unknown');
                const response = await fetch(`${API_BASE_URL}/api/ai/recommendations`);
                console.log('📡 AI recommendations API response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('📊 AI recommendations data received:', data);
                
                const container = document.getElementById('aiRecommendationsList');
                if (container && data.recommendations) {
                    container.innerHTML = data.recommendations.map(rec => `
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-gray-600 text-sm">${getCategoryIcon(rec.category)}</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900 text-sm">${rec.title}</h3>
                                    <p class="text-xs text-gray-500">${rec.description}</p>
                                </div>
                            </div>
                            <button onclick="runWhatIf('${rec.title}', ${rec.savings}, '${rec.period}')" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium">
                                What if
                            </button>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading AI recommendations:', error);
                // Fallback to demo recommendations
                const container = document.getElementById('aiRecommendationsList');
                if (container) {
                    container.innerHTML = `
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-gray-600 text-sm">☕</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900 text-sm">Cut coffee</h3>
                                    <p class="text-xs text-gray-500">Stop buying coffee for 10 days</p>
                                </div>
                            </div>
                            <button onclick="runWhatIf('Cut coffee', 30, '10 days')" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium">
                                What if
                            </button>
                        </div>
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-gray-600 text-sm">🎬</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900 text-sm">Remove Netflix subscription</h3>
                                    <p class="text-xs text-gray-500">Cancel Netflix to save $80/year</p>
                                </div>
                            </div>
                            <button onclick="runWhatIf('Remove Netflix subscription', 80, 'year')" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium">
                                What if
                            </button>
                        </div>
                    `;
                }
            }
        }

        // Load goals from API
        async function loadGoals() {
            try {
                console.log('🎯 Fetching goals from API for user:', currentUser?.name || 'Unknown');
                const response = await fetch(`${API_BASE_URL}/api/goals/`);
                console.log('📡 Goals API response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const goals = await response.json();
                console.log('📊 Goals data received:', goals);
                
                const container = document.getElementById('goalsList');
                if (container) {
                    container.innerHTML = goals.map((goal, index) => `
                        <div class="border border-gray-200 rounded-lg p-3 mb-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-medium text-gray-900 text-sm">${goal.title}</h3>
                                <span class="text-xs text-gray-500">$${goal.current_amount} / $${goal.target_amount}</span>
                            </div>
                            
                            <!-- Show total saved from all associated streaks -->
                            <div class="mb-2 p-2 bg-green-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-green-700 font-medium">💰 Total Saved from Streaks:</span>
                                    <span class="text-sm font-bold text-green-600">$${goal.current_amount}</span>
                                </div>
                                ${goal.linked_streaks && goal.linked_streaks.length > 0 ? `
                                    <div class="mt-1">
                                        <span class="text-xs text-gray-600">Linked Streaks: ${goal.linked_streaks.length}</span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-primary-600 h-2 rounded-full" style="width: ${goal.progress.progress_percentage}%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1 mb-3">
                                <span>${Math.round(goal.progress.progress_percentage)}% Complete</span>
                                <span>${goal.progress.days_remaining} days left</span>
                            </div>
                            
                            <!-- See Trajectory Button -->
                            <div class="mt-3">
                                <button onclick="showGoalTrajectory(${index}, '${goal.title}', ${goal.current_amount}, ${goal.target_amount}, ${goal.progress.progress_percentage}, ${goal.progress.days_remaining})" 
                                        class="w-full bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    See Trajectory
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
                
                // Charts will be shown when "See Trajectory" button is clicked
                
                // Update active goals count
                const activeGoalsCount = goals.filter(goal => goal.status === 'active').length;
                const countElement = document.getElementById('activeGoalsCount');
                if (countElement) {
                    countElement.textContent = activeGoalsCount;
                }
            } catch (error) {
                console.error('Error loading goals:', error);
            }
        }

        // Load reminders from localStorage
        function loadReminders() {
            try {
                console.log('⏰ Loading reminders for user:', currentUser?.name || 'Unknown');
                
                const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
                console.log('📊 Reminders data:', reminders);
                
                const container = document.getElementById('remindersList');
                const emptyState = document.getElementById('emptyRemindersState');
                
                if (reminders.length === 0) {
                    if (container) container.innerHTML = '';
                    if (emptyState) emptyState.classList.remove('hidden');
                    return;
                }
                
                if (emptyState) emptyState.classList.add('hidden');
                
                if (container) {
                    container.innerHTML = reminders.map((reminder, index) => `
                        <div class="bg-white shadow rounded-lg p-6 border border-gray-200">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-blue-600 text-lg">💳</span>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">${reminder.cardName}</h3>
                                        <p class="text-sm text-gray-500">Due on the ${reminder.dueDate}${getOrdinalSuffix(reminder.dueDate)} of every month</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${getReminderTypeColor(reminder.type)}">
                                        ${getReminderTypeText(reminder.type)}
                                    </span>
                                    <button onclick="deleteReminder(${index})" class="text-red-500 hover:text-red-700">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between text-sm text-gray-600">
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span>Reminder at ${formatTime(reminder.time)}</span>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span>Next: ${getNextReminderDate(reminder.dueDate)}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading reminders:', error);
            }
        }

        // Helper functions for reminders
        function getOrdinalSuffix(day) {
            if (day >= 11 && day <= 13) return 'th';
            switch (day % 10) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
            }
        }

        function getReminderTypeColor(type) {
            switch (type) {
                case 'email': return 'bg-green-100 text-green-800';
                case 'browser': return 'bg-blue-100 text-blue-800';
                case 'both': return 'bg-purple-100 text-purple-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getReminderTypeText(type) {
            switch (type) {
                case 'email': return 'Email';
                case 'browser': return 'Browser';
                case 'both': return 'Email + Browser';
                default: return 'Unknown';
            }
        }

        function formatTime(time) {
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        function getNextReminderDate(dueDate) {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Create date for this month
            const thisMonth = new Date(currentYear, currentMonth, parseInt(dueDate));
            
            if (thisMonth > today) {
                return thisMonth.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
            } else {
                // Next month
                const nextMonth = new Date(currentYear, currentMonth + 1, parseInt(dueDate));
                return nextMonth.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
            }
        }

        // Reminder modal functions
        function showReminderModal() {
            document.getElementById('reminderModal').classList.remove('hidden');
        }

        function hideReminderModal() {
            document.getElementById('reminderModal').classList.add('hidden');
            document.getElementById('reminderForm').reset();
        }

        // Add reminder
        function addReminder(reminderData) {
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            reminders.push({
                id: Date.now(),
                ...reminderData,
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('reminders', JSON.stringify(reminders));
            loadReminders();
        }

        // Delete reminder
        function deleteReminder(index) {
            if (confirm('Are you sure you want to delete this reminder?')) {
                const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
                reminders.splice(index, 1);
                localStorage.setItem('reminders', JSON.stringify(reminders));
                loadReminders();
            }
        }

        // Handle reminder form submission
        document.getElementById('reminderForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const reminderData = {
                cardName: document.getElementById('reminderCardName').value,
                dueDate: document.getElementById('reminderDueDate').value,
                time: document.getElementById('reminderTime').value,
                type: document.getElementById('reminderType').value
            };
            
            addReminder(reminderData);
            hideReminderModal();
            alert('Reminder added successfully! ⏰');
        });

        // Load active streaks
        async function loadStreaks() {
            try {
                console.log('🔥 Fetching streaks from API for user:', currentUser?.name || 'Unknown');
                const response = await fetch(`${API_BASE_URL}/api/streaks`);
                console.log('📡 Streaks API response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const streaks = await response.json();
                console.log('📊 Streaks data received:', streaks);
                
                const container = document.getElementById('activeStreaksList');
                if (container) {
                    const activeStreaks = streaks.filter(streak => streak.status === 'active');
                    
                    if (activeStreaks.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-8 text-gray-500">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-2xl">🎯</span>
                                </div>
                                <p class="text-sm">No active streaks yet</p>
                                <p class="text-xs text-gray-400">Start a streak to save money!</p>
                            </div>
                        `;
                    } else {
                        container.innerHTML = activeStreaks.map(streak => `
                            <div class="border border-gray-200 rounded-lg p-3 mb-3">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 ${streak.category === 'Food & Dining' ? 'bg-green-100' : streak.category === 'Entertainment' ? 'bg-purple-100' : streak.category === 'Transportation' ? 'bg-blue-100' : 'bg-orange-100'} rounded-lg flex items-center justify-center mr-3">
                                            <span class="text-lg">${getCategoryIcon(streak.category)}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <h3 class="font-semibold text-gray-900 text-sm mr-2">${streak.title}</h3>
                                            <div class="flex items-center bg-green-100 text-green-700 px-2 py-1 rounded-full">
                                                <span class="text-sm mr-1">💰</span>
                                                <span class="text-sm font-bold">${streak.currentStreak}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-semibold text-green-600">$${streak.savings}</div>
                                        <div class="text-xs text-gray-500">${streak.period}</div>
                                    </div>
                                </div>
                                
                                ${streak.linkedGoalTitle ? `
                                    <div class="flex items-center gap-1 mb-2">
                                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                                            🎯 ${streak.linkedGoalTitle}
                                        </span>
                                    </div>
                                ` : ''}
                                
                                <!-- Money Saving Progress with Icons -->
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs text-gray-600">Money Saved</span>
                                    <div class="flex items-center">
                                        <span class="text-xs text-green-600 font-semibold mr-1">$${Math.round((streak.currentStreak / streak.duration) * streak.savings)}</span>
                                        <span class="text-xs text-gray-500">of $${streak.savings}</span>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-1 flex-wrap">
                                    ${Array.from({length: Math.min(streak.currentStreak, 10)}, (_, i) => 
                                        `<span class="text-xs">💰</span>`
                                    ).join('')}
                                    ${Array.from({length: Math.max(0, Math.min(10 - streak.currentStreak, 5))}, (_, i) => 
                                        `<span class="text-xs text-gray-300">💰</span>`
                                    ).join('')}
                                    ${streak.currentStreak > 10 ? `<span class="text-xs text-gray-500">+${streak.currentStreak - 10}</span>` : ''}
                                </div>
                                
                                <!-- Streak Actions -->
                                <div class="flex justify-between items-center mt-2">
                                    <div class="flex space-x-1">
                                        <button onclick="updateStreak('${streak.id}', 'complete')" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full hover:bg-green-200">
                                            ✓
                                        </button>
                                        <button onclick="updateStreak('${streak.id}', 'skip')" class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full hover:bg-yellow-200">
                                            Skip
                                        </button>
                                    </div>
                                    <button onclick="endStreak('${streak.id}')" class="text-xs text-red-600 hover:text-red-700">
                                        End
                                    </button>
                                </div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading streaks:', error);
            }
        }

        // Update streak progress
        async function updateStreak(streakId, action) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/streaks/${streakId}/${action}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    loadStreaks(); // Reload streaks
                    loadGoals(); // Reload goals to show updated progress
                    if (action === 'complete') {
                        alert('Great job! Streak updated! 🎉');
                    }
                } else {
                    alert('Error updating streak. Please try again.');
                }
            } catch (error) {
                console.error('Error updating streak:', error);
                alert('Error updating streak. Please try again.');
            }
        }

        // End streak
        async function endStreak(streakId) {
            if (confirm('Are you sure you want to end this streak?')) {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/streaks/${streakId}/end`, {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        loadStreaks(); // Reload streaks
                        loadGoals(); // Reload goals to show updated progress
                        alert('Streak ended. You can start a new one anytime!');
                    } else {
                        alert('Error ending streak. Please try again.');
                    }
                } catch (error) {
                    console.error('Error ending streak:', error);
                    alert('Error ending streak. Please try again.');
                }
            }
        }

        // Get category icon
        function getCategoryIcon(category) {
            const icons = {
                'Food & Dining': '☕',
                'Subscriptions': '📱',
                'Movies': '🎬',
                'Cab': '🚗',
                'Shopping': '🛍️',
                'Grocery': '🛒',
                'Travel': '✈️',
                'Misc': '💰',
                'Entertainment': '🎬',
                'Transportation': '🚗',
                'Utilities': '⚡'
            };
            return icons[category] || '💰';
        }

        // Goal creation modal functions
        let currentStep = 1;
        let goalData = {};
        let selectedStreaks = [];

        function showGoalModal() {
            showGoalCreationModal();
        }

        function hideGoalModal() {
            document.getElementById('goalModal').classList.add('hidden');
        }

        function showGoalCreationModal() {
            currentStep = 1;
            goalData = {};
            selectedStreaks = [];
            updateStepDisplay();
            document.getElementById('goalCreationModal').classList.remove('hidden');
            
            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const dateString = tomorrow.toISOString().split('T')[0];
            document.getElementById('goalDate').value = dateString;
        }

        function hideGoalCreationModal() {
            document.getElementById('goalCreationModal').classList.add('hidden');
        }

        function updateStepDisplay() {
            const stepIndicator = document.getElementById('stepIndicator');
            const stepTitle = document.getElementById('stepTitle');
            const step1Content = document.getElementById('step1Content');
            const step2Content = document.getElementById('step2Content');
            const step3Content = document.getElementById('step3Content');
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');

            // Hide all steps
            step1Content.classList.add('hidden');
            step2Content.classList.add('hidden');
            step3Content.classList.add('hidden');

            if (currentStep === 1) {
                stepIndicator.textContent = 'Step 1/3';
                stepTitle.textContent = 'Set Your Goal';
                step1Content.classList.remove('hidden');
                prevButton.classList.add('hidden');
                nextButton.textContent = 'Next';
            } else if (currentStep === 2) {
                stepIndicator.textContent = 'Step 2/3';
                stepTitle.textContent = 'Choose Saving Strategies';
                step2Content.classList.remove('hidden');
                prevButton.classList.remove('hidden');
                nextButton.textContent = 'Next';
                loadStreakSuggestions();
            } else if (currentStep === 3) {
                stepIndicator.textContent = 'Step 3/3';
                stepTitle.textContent = 'Goal Preview';
                step3Content.classList.remove('hidden');
                prevButton.classList.remove('hidden');
                nextButton.textContent = 'Create Goal';
                generateGoalPreview();
            }
        }

        function nextStep() {
            if (currentStep === 1) {
                // Validate step 1
                const title = document.getElementById('goalTitle').value.trim();
                const amount = document.getElementById('goalAmount').value.trim();
                const date = document.getElementById('goalDate').value.trim();
                
                console.log('Validation check:', { title, amount, date }); // Debug log
                console.log('Field values:', {
                    titleElement: document.getElementById('goalTitle'),
                    amountElement: document.getElementById('goalAmount'),
                    dateElement: document.getElementById('goalDate'),
                    titleValue: document.getElementById('goalTitle').value,
                    amountValue: document.getElementById('goalAmount').value,
                    dateValue: document.getElementById('goalDate').value
                });
                
                if (!title || !amount || !date) {
                    alert(`Please fill in all required fields:\n- Goal Title: "${title}"\n- Target Amount: "${amount}"\n- Target Date: "${date}"`);
                    return;
                }

                // Additional validation
                if (parseFloat(amount) <= 0) {
                    alert('Target amount must be greater than 0');
                    return;
                }

                const targetDate = new Date(date);
                const today = new Date();
                if (targetDate <= today) {
                    alert('Target date must be in the future');
                    return;
                }

                // Save goal data
                goalData = {
                    title: title,
                    description: document.getElementById('goalDescription').value.trim(),
                    target_amount: parseFloat(amount),
                    target_date: date + 'T00:00:00Z',
                    category: document.getElementById('goalCategory').value,
                    priority: 'medium'
                };

                console.log('Goal data saved:', goalData); // Debug log

                currentStep = 2;
                updateStepDisplay();
            } else if (currentStep === 2) {
                if (selectedStreaks.length === 0) {
                    alert('Please select at least one saving strategy');
                    return;
                }
                currentStep = 3;
                updateStepDisplay();
            } else if (currentStep === 3) {
                createGoalWithStreaks();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        // Load streak suggestions based on goal
        async function loadStreakSuggestions() {
            console.log('Loading streak suggestions...');
            
            // Get current active streaks to check for duplicates
            let activeStreaks = [];
            try {
                const response = await fetch(`${API_BASE_URL}/api/streaks`);
                const allStreaks = await response.json();
                activeStreaks = allStreaks.filter(streak => streak.status === 'active');
            } catch (error) {
                console.error('Error loading active streaks:', error);
            }
            
            const suggestions = [
                {
                    id: 'coffee',
                    title: 'Skip Coffee',
                    description: 'Skip buying coffee for 30 days',
                    savings: 90,
                    period: 'month',
                    icon: '☕',
                    category: 'Food & Dining',
                    difficulty: 'Easy'
                },
                {
                    id: 'netflix',
                    title: 'Cancel Netflix',
                    description: 'Pause Netflix subscription for 3 months',
                    savings: 48,
                    period: '3 months',
                    icon: '🎬',
                    category: 'Entertainment',
                    difficulty: 'Easy'
                },
                {
                    id: 'cooking',
                    title: 'Cook at Home',
                    description: 'Cook at home 5 times per week',
                    savings: 200,
                    period: 'month',
                    icon: '🍳',
                    category: 'Food & Dining',
                    difficulty: 'Medium'
                },
                {
                    id: 'transport',
                    title: 'Use Public Transport',
                    description: 'Use public transport instead of Uber',
                    savings: 120,
                    period: 'month',
                    icon: '🚌',
                    category: 'Transportation',
                    difficulty: 'Medium'
                },
                {
                    id: 'subscriptions',
                    title: 'Review Subscriptions',
                    description: 'Cancel unused subscriptions',
                    savings: 60,
                    period: 'month',
                    icon: '📱',
                    category: 'Subscriptions',
                    difficulty: 'Easy'
                },
                {
                    id: 'shopping',
                    title: 'No Impulse Shopping',
                    description: 'Wait 24 hours before buying non-essentials',
                    savings: 150,
                    period: 'month',
                    icon: '🛍️',
                    category: 'Shopping',
                    difficulty: 'Hard'
                },
                {
                    id: 'gym',
                    title: 'Home Workouts',
                    description: 'Work out at home instead of gym membership',
                    savings: 80,
                    period: 'month',
                    icon: '💪',
                    category: 'Health & Fitness',
                    difficulty: 'Medium'
                },
                {
                    id: 'energy',
                    title: 'Save Energy',
                    description: 'Reduce electricity usage by 20%',
                    savings: 40,
                    period: 'month',
                    icon: '⚡',
                    category: 'Utilities',
                    difficulty: 'Easy'
                }
            ];

            const container = document.getElementById('streakSuggestions');
            if (!container) {
                console.error('Streak suggestions container not found!');
                return;
            }
            
            container.innerHTML = '';
            console.log('Creating streak cards for', suggestions.length, 'suggestions');

            suggestions.forEach((suggestion, index) => {
                console.log(`Creating card ${index + 1}:`, suggestion.title);
                
                // Check if this streak is already active
                const isAlreadyActive = activeStreaks.some(streak => 
                    streak.title === suggestion.title && streak.category === suggestion.category
                );
                
                const streakCard = document.createElement('div');
                streakCard.className = `border rounded-lg p-4 transition-all duration-300 ${
                    isAlreadyActive 
                        ? 'border-yellow-300 bg-yellow-50 cursor-not-allowed opacity-60' 
                        : 'border-gray-200 cursor-pointer hover:shadow-md'
                }`;
                
                if (!isAlreadyActive) {
                    streakCard.onclick = () => toggleStreak(suggestion.id, streakCard);
                }
                
                const difficultyColor = suggestion.difficulty === 'Easy' ? 'bg-green-100 text-green-700' : 
                                      suggestion.difficulty === 'Medium' ? 'bg-yellow-100 text-yellow-700' : 
                                      'bg-red-100 text-red-700';
                
                streakCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-xl">${suggestion.icon}</span>
                            </div>
                            <div class="flex items-center">
                                <h4 class="font-semibold text-gray-900 text-base mr-3">${suggestion.title}</h4>
                                <div class="flex items-center bg-blue-100 text-blue-700 px-2 py-1 rounded-full">
                                    <span class="text-sm mr-1">💰</span>
                                    <span class="text-sm font-bold">$${suggestion.savings}</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-500">${suggestion.period}</div>
                            ${isAlreadyActive ? '<div class="text-xs text-yellow-600 font-medium mt-1">Already Active</div>' : ''}
                        </div>
                    </div>
                    <div class="ml-16">
                        <p class="text-sm text-gray-600">${suggestion.description}</p>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs px-2 py-1 rounded-full ${difficultyColor}">
                            ${suggestion.difficulty}
                        </span>
                        ${isAlreadyActive ? 
                            '<span class="text-xs text-yellow-600 font-medium">Active</span>' :
                            '<div class="w-5 h-5 border-2 border-gray-300 rounded-full flex items-center justify-center"><div class="w-3 h-3 bg-primary-600 rounded-full hidden"></div></div>'
                        }
                    </div>
                `;
                
                container.appendChild(streakCard);
            });
            
            console.log('Streak suggestions loaded successfully');
        }

        function toggleStreak(streakId, element) {
            const isSelected = selectedStreaks.includes(streakId);
            const checkIcon = element.querySelector('.w-3.h-3');
            
            if (isSelected) {
                selectedStreaks = selectedStreaks.filter(id => id !== streakId);
                element.classList.remove('border-primary-500', 'bg-primary-50');
                element.classList.add('border-gray-200');
                checkIcon.classList.add('hidden');
            } else {
                selectedStreaks.push(streakId);
                element.classList.add('border-primary-500', 'bg-primary-50');
                element.classList.remove('border-gray-200');
                checkIcon.classList.remove('hidden');
            }
        }

        function generateGoalPreview() {
            const totalSavings = selectedStreaks.reduce((total, streakId) => {
                const suggestions = [
                    { id: 'coffee', savings: 90 },
                    { id: 'netflix', savings: 48 },
                    { id: 'cooking', savings: 200 },
                    { id: 'transport', savings: 120 },
                    { id: 'subscriptions', savings: 60 },
                    { id: 'shopping', savings: 150 }
                ];
                const suggestion = suggestions.find(s => s.id === streakId);
                return total + (suggestion ? suggestion.savings : 0);
            }, 0);

            const monthsToGoal = Math.ceil(goalData.target_amount / totalSavings);
            const originalMonths = Math.ceil(goalData.target_amount / 300); // Assuming $300/month without streaks

            const preview = document.getElementById('goalPreview');
            preview.innerHTML = `
                <div class="text-center mb-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-2">${goalData.title}</h3>
                    <p class="text-gray-600">${goalData.description}</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary-600">$${goalData.target_amount}</div>
                        <div class="text-sm text-gray-600">Target Amount</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600">$${totalSavings}</div>
                        <div class="text-sm text-gray-600">Monthly Savings</div>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-gray-900 mb-3">Selected Strategies:</h4>
                    <div class="space-y-2">
                        ${selectedStreaks.map(streakId => {
                            const suggestions = [
                                { id: 'coffee', title: 'Skip Coffee', savings: 90, icon: '☕' },
                                { id: 'netflix', title: 'Cancel Netflix', savings: 48, icon: '🎬' },
                                { id: 'cooking', title: 'Cook at Home', savings: 200, icon: '🍳' },
                                { id: 'transport', title: 'Use Public Transport', savings: 120, icon: '🚌' },
                                { id: 'subscriptions', title: 'Review Subscriptions', savings: 60, icon: '📱' },
                                { id: 'shopping', title: 'No Impulse Shopping', savings: 150, icon: '🛍️' }
                            ];
                            const suggestion = suggestions.find(s => s.id === streakId);
                            return suggestion ? `
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="mr-2">${suggestion.icon}</span>
                                        <span class="text-sm">${suggestion.title}</span>
                                    </div>
                                    <span class="text-sm font-semibold text-green-600">$${suggestion.savings}/month</span>
                                </div>
                            ` : '';
                        }).join('')}
                    </div>
                </div>

                <div class="text-center">
                    <div class="text-lg font-semibold text-gray-800 mb-2">
                        🎉 You'll reach your goal in ${monthsToGoal} months!
                    </div>
                    <div class="text-sm text-gray-600">
                        ${monthsToGoal < originalMonths ? `That's ${originalMonths - monthsToGoal} months faster than without streaks!` : 'Great progress!'}
                    </div>
                </div>
            `;
        }

        async function createGoalWithStreaks() {
            try {
                // Create streaks first
                const createdStreaks = [];
                const streakSuggestions = [
                    {
                        id: 'coffee',
                        title: 'Skip Coffee',
                        description: 'Skip buying coffee for 30 days',
                        savings: 90,
                        period: 'month',
                        category: 'Food & Dining',
                        duration: 30
                    },
                    {
                        id: 'netflix',
                        title: 'Cancel Netflix',
                        description: 'Pause Netflix subscription for 3 months',
                        savings: 48,
                        period: '3 months',
                        category: 'Entertainment',
                        duration: 90
                    },
                    {
                        id: 'cooking',
                        title: 'Cook at Home',
                        description: 'Cook at home 5 times per week',
                        savings: 200,
                        period: 'month',
                        category: 'Food & Dining',
                        duration: 30
                    },
                    {
                        id: 'transport',
                        title: 'Use Public Transport',
                        description: 'Use public transport instead of Uber',
                        savings: 120,
                        period: 'month',
                        category: 'Transportation',
                        duration: 30
                    },
                    {
                        id: 'subscriptions',
                        title: 'Review Subscriptions',
                        description: 'Cancel unused subscriptions',
                        savings: 60,
                        period: 'month',
                        category: 'Subscriptions',
                        duration: 30
                    },
                    {
                        id: 'shopping',
                        title: 'No Impulse Shopping',
                        description: 'Wait 24 hours before buying non-essentials',
                        savings: 150,
                        period: 'month',
                        category: 'Shopping',
                        duration: 30
                    },
                    {
                        id: 'gym',
                        title: 'Home Workouts',
                        description: 'Work out at home instead of gym membership',
                        savings: 80,
                        period: 'month',
                        category: 'Health & Fitness',
                        duration: 30
                    },
                    {
                        id: 'energy',
                        title: 'Save Energy',
                        description: 'Reduce electricity usage by 20%',
                        savings: 40,
                        period: 'month',
                        category: 'Utilities',
                        duration: 30
                    }
                ];

                // Prepare streak data for goal creation (backend will handle creation/linking)
                for (const streakId of selectedStreaks) {
                    const suggestion = streakSuggestions.find(s => s.id === streakId);
                    if (suggestion) {
                        // Create streak data object for backend to process
                        createdStreaks.push({
                            title: suggestion.title,
                            description: suggestion.description,
                            savings: suggestion.savings,
                            period: suggestion.period,
                            category: suggestion.category,
                            duration: suggestion.duration
                        });
                    }
                }

                // Create goal with linked streaks
                const goalResponse = await fetch(`${API_BASE_URL}/api/goals`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        goalData: goalData,
                        selectedStreaks: createdStreaks
                    })
                });

                if (!goalResponse.ok) {
                    throw new Error('Failed to create goal');
                }

                hideGoalCreationModal();
                loadGoals();
                loadStreaks();
                alert('Goal created successfully with linked streaks! 🎉');
            } catch (error) {
                console.error('Error creating goal:', error);
                alert('Error creating goal. Please try again.');
            }
        }

        // Strategy modal functions
        function showStrategyModal() {
            document.getElementById('strategyModal').classList.remove('hidden');
        }

        function hideStrategyModal() {
            document.getElementById('strategyModal').classList.add('hidden');
        }

        // Strategy selection
        let selectedStrategy = null;

        function selectStrategy(strategy) {
            selectedStrategy = strategy;
            
            // Update visual selection
            const swiftCard = document.getElementById('swiftSaverCard');
            const steadyCard = document.getElementById('steadySpenderCard');
            
            if (strategy === 'swift') {
                swiftCard.classList.add('border-green-500', 'bg-green-50');
                swiftCard.classList.remove('border-green-200');
                steadyCard.classList.add('border-gray-200');
                steadyCard.classList.remove('border-blue-500', 'bg-blue-50');
                
                // Update motivational message
                document.getElementById('motivationalMessage').textContent = 
                    'Cut coffee + Netflix = Reach goal 8 months early! 😊';
            } else {
                steadyCard.classList.add('border-blue-500', 'bg-blue-50');
                steadyCard.classList.remove('border-gray-200');
                swiftCard.classList.add('border-green-200');
                swiftCard.classList.remove('border-green-500', 'bg-green-50');
                
                // Update motivational message
                document.getElementById('motivationalMessage').textContent = 
                    'Student Spotify + Cooking = Reach goal 4 months early! 🍳';
            }
        }

        // Confirm strategy and start streak
        async function confirmStrategy() {
            if (!selectedStrategy) {
                alert('Please select a strategy first!');
                return;
            }

            try {
                const streakData = {
                    strategy: selectedStrategy,
                    startDate: new Date().toISOString(),
                    status: 'active'
                };

                const response = await fetch(`${API_BASE_URL}/api/streaks/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(streakData)
                });

                if (response.ok) {
                    hideStrategyModal();
                    loadStreaks(); // Load updated streaks
                    alert(`Great! You've started your ${selectedStrategy === 'swift' ? 'Swift Saver' : 'Steady Spender'} streak! 🎉`);
                } else {
                    alert('Error starting streak. Please try again.');
                }
            } catch (error) {
                console.error('Error starting streak:', error);
                alert('Error starting streak. Please try again.');
            }
        }

        // What-if modal functions
        function showWhatIfModal() {
            document.getElementById('whatIfModal').classList.remove('hidden');
        }

        function hideWhatIfModal() {
            document.getElementById('whatIfModal').classList.add('hidden');
        }

        // Run what-if analysis
        async function runWhatIf(recommendation, savings, period) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/what-if/analysis`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        recommendation,
                        savings,
                        period
                    })
                });
                
                const result = await response.json();
                
                // Generate trajectory data
                const trajectoryData = generateTrajectoryData(savings, period);
                
                const content = document.getElementById('whatIfContent');
                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-900 mb-2">${recommendation}</h4>
                            <p class="text-sm text-blue-800">${period}</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Current Savings:</span>
                                <span class="font-medium text-gray-900">$${result.current_savings}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">New Savings:</span>
                                <span class="font-medium text-green-600">$${result.new_savings}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Additional Monthly:</span>
                                <span class="font-medium text-primary-600">+$${result.additional_savings}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">New Savings Rate:</span>
                                <span class="font-medium text-green-600">${result.new_savings_rate}%</span>
                            </div>
                        </div>
                        
                            <div class="bg-white border border-gray-200 rounded-lg p-6">
                                <h4 class="font-semibold text-gray-900 mb-4 text-lg">Savings Trajectory</h4>
                                <div class="h-96 w-full">
                                    <canvas id="trajectoryChart"></canvas>
                                </div>
                            </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                            <p class="text-sm text-green-800">${result.impact.goal_acceleration}</p>
                        </div>
                    </div>
                `;
                
                // Draw the trajectory chart
                setTimeout(() => {
                    drawTrajectoryChart(trajectoryData);
                }, 100);
                
                showWhatIfModal();
            } catch (error) {
                console.error('Error running what-if analysis:', error);
            }
        }
        
        // Generate trajectory data for the chart
        function generateTrajectoryData(savings, period) {
            const data = [];
            const currentDate = new Date();
            const totalDays = period.includes('month') ? 30 : period.includes('year') ? 365 : 7;
            const dailySavings = savings / totalDays;
            
            for (let i = 0; i <= totalDays; i += Math.max(1, Math.floor(totalDays / 20))) {
                const date = new Date(currentDate);
                date.setDate(date.getDate() + i);
                const cumulativeSavings = dailySavings * i;
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    day: i,
                    savings: Math.round(cumulativeSavings * 100) / 100
                });
            }
            
            return data;
        }
        
        // Draw trajectory chart using Chart.js
        function drawTrajectoryChart(data) {
            const canvas = document.getElementById('trajectoryChart');
            if (!canvas) return;

            // Prepare data for Chart.js
            const labels = data.map(point => `Day ${point.day}`);
            const savingsData = data.map(point => Math.round(point.savings * 100) / 100);

            // Create Chart.js chart
            new Chart(canvas, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Cumulative Savings',
                        data: savingsData,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 4,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Cumulative Savings Over Time',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#1f2937'
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'circle',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `Day ${context.label}: $${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Time (Days)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Savings Amount ($)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            },
                            beginAtZero: true
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    },
                    elements: {
                        line: {
                            tension: 0.4
                        }
                    }
                }
            });
        }

        // Draw goal trajectory chart using Chart.js
        function drawGoalTrajectoryChart(goal, index) {
            const canvas = document.getElementById(`goalTrajectoryChart${index}`);
            if (!canvas) return;
            
            // Calculate trajectory data
            const totalDays = Math.max(30, goal.progress.days_remaining + Math.floor(goal.progress.progress_percentage * goal.progress.days_remaining / Math.max(1, 100 - goal.progress.progress_percentage)));
            const dailySavings = (goal.target_amount - goal.current_amount) / totalDays;
            const currentDay = Math.floor(goal.progress.progress_percentage * totalDays / 100);
            
            // Generate data points
            const labels = [];
            const savingsData = [];
            const noSavingsData = [];
            const targetData = [];
            
            for (let i = 0; i <= totalDays; i += Math.max(1, Math.floor(totalDays / 15))) {
                const dayLabel = i === 0 ? 'Start' : i === currentDay ? 'Now' : i === totalDays ? 'Target' : `Day ${i}`;
                labels.push(dayLabel);
                
                const savingsAmount = Math.min(goal.current_amount + (dailySavings * i), goal.target_amount);
                const noSavingsAmount = goal.current_amount;
                
                savingsData.push(Math.round(savingsAmount * 100) / 100);
                noSavingsData.push(Math.round(noSavingsAmount * 100) / 100);
                targetData.push(goal.target_amount);
            }
            
            // Create Chart.js chart
            new Chart(canvas, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'With Savings',
                            data: savingsData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 4,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'No Savings',
                            data: noSavingsData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            borderDash: [8, 4],
                            fill: false,
                            tension: 0,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#ef4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Target Amount',
                            data: targetData,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            borderDash: [6, 3],
                            fill: false,
                            tension: 0,
                            pointRadius: 0,
                            pointHoverRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Goal: ${goal.title}`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: '#1f2937'
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'line',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Time Progress',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Amount ($)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                },
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            },
                            beginAtZero: true
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    },
                    elements: {
                        line: {
                            tension: 0.4
                        }
                    }
                }
            });
        }

        // Show goal trajectory modal
        function showGoalTrajectory(index, title, currentAmount, targetAmount, progressPercentage, daysRemaining) {
            // Set modal title
            document.getElementById('trajectoryModalTitle').textContent = `Goal Trajectory: ${title}`;
            
            // Show modal
            document.getElementById('goalTrajectoryModal').classList.remove('hidden');
            
            // Create goal object for chart
            const goal = {
                title: title,
                current_amount: currentAmount,
                target_amount: targetAmount,
                progress: {
                    progress_percentage: progressPercentage,
                    days_remaining: daysRemaining
                }
            };
            
            // Draw chart in modal
            setTimeout(() => {
                drawGoalTrajectoryChartModal(goal);
            }, 100);
        }

        // Hide goal trajectory modal
        function hideGoalTrajectoryModal() {
            document.getElementById('goalTrajectoryModal').classList.add('hidden');
        }

        // Generate real trajectory data based on actual streak completions
        async function generateRealTrajectoryData(goal, totalDays) {
            try {
                // Fetch current streaks data
                const response = await fetch(`${API_BASE_URL}/api/streaks`);
                const streaks = await response.json();
                
                // Filter streaks linked to this goal
                const linkedStreaks = streaks.filter(streak => 
                    streak.linkedGoalId === goal.id && streak.status === 'active'
                );
                
                console.log(`Generating real trajectory for goal: ${goal.title}`);
                console.log(`Current goal amount: $${goal.current_amount}`);
                console.log(`Linked streaks:`, linkedStreaks);
                
                // Generate real trajectory data
                const realData = [];
                
                // Calculate total daily savings from all linked streaks
                let totalDailySavings = 0;
                linkedStreaks.forEach(streak => {
                    const dailySavings = streak.savings / streak.duration;
                    totalDailySavings += dailySavings;
                    console.log(`Streak ${streak.title}: $${streak.savings} over ${streak.duration} days = $${dailySavings.toFixed(2)}/day`);
                });
                
                console.log(`Total daily savings: $${totalDailySavings.toFixed(2)}`);
                
                // Calculate how many days have passed since goal creation
                const goalCreatedDate = new Date(goal.created_at || goal.updated_at);
                const daysSinceGoalCreated = Math.floor((new Date() - goalCreatedDate) / (1000 * 60 * 60 * 24));
                
                // Generate trajectory showing actual progress
                for (let day = 0; day <= totalDays; day++) {
                    let daySavings = 0;
                    
                    if (day <= daysSinceGoalCreated) {
                        // For past days, show a realistic progression to current amount
                        if (daysSinceGoalCreated > 0) {
                            const progressRatio = day / daysSinceGoalCreated;
                            daySavings = goal.current_amount * progressRatio;
                        } else {
                            daySavings = 0;
                        }
                    } else {
                        // For future days, project based on current daily savings rate
                        daySavings = goal.current_amount + (totalDailySavings * (day - daysSinceGoalCreated));
                    }
                    
                    // Cap at the target amount
                    daySavings = Math.min(daySavings, goal.target_amount);
                    realData[day] = daySavings;
                }
                
                console.log(`Real trajectory data (first 10 days):`, realData.slice(0, 10));
                return realData;
            } catch (error) {
                console.error('Error generating real trajectory data:', error);
                // Fallback to current amount if API fails
                const realData = [];
                for (let day = 0; day <= totalDays; day++) {
                    realData[day] = goal.current_amount;
                }
                return realData;
            }
        }

        // Draw goal trajectory chart in modal
        async function drawGoalTrajectoryChartModal(goal) {
            const canvas = document.getElementById('goalTrajectoryChartModal');
            if (!canvas) return;
            
            // Destroy existing chart if it exists
            if (window.goalTrajectoryChart) {
                window.goalTrajectoryChart.destroy();
            }
            
            // Calculate trajectory data
            const totalDays = Math.max(30, goal.progress.days_remaining + Math.floor(goal.progress.progress_percentage * goal.progress.days_remaining / Math.max(1, 100 - goal.progress.progress_percentage)));
            const dailySavings = (goal.target_amount - goal.current_amount) / totalDays;
            const currentDay = Math.floor(goal.progress.progress_percentage * totalDays / 100);
            
            // Generate real trajectory data based on actual streak completions
            const realTrajectoryData = await generateRealTrajectoryData(goal, totalDays);
            
            // Generate data points
            const labels = [];
            const savingsData = [];
            const realSavingsData = [];
            const noSavingsData = [];
            const targetData = [];
            
            for (let i = 0; i <= totalDays; i += Math.max(1, Math.floor(totalDays / 15))) {
                const dayLabel = i === 0 ? 'Start' : i === currentDay ? 'Now' : i === totalDays ? 'Target' : `Day ${i}`;
                labels.push(dayLabel);
                
                const savingsAmount = Math.min(goal.current_amount + (dailySavings * i), goal.target_amount);
                const realAmount = realTrajectoryData[i] || goal.current_amount;
                const noSavingsAmount = goal.current_amount;
                
                savingsData.push(Math.round(savingsAmount * 100) / 100);
                realSavingsData.push(Math.round(realAmount * 100) / 100);
                noSavingsData.push(Math.round(noSavingsAmount * 100) / 100);
                targetData.push(goal.target_amount);
            }
            
            // Create Chart.js chart
            window.goalTrajectoryChart = new Chart(canvas, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Ideal Trajectory',
                            data: savingsData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Real Progress',
                            data: realSavingsData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 4,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'No Savings',
                            data: noSavingsData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            borderDash: [8, 4],
                            fill: false,
                            tension: 0,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            pointBackgroundColor: '#ef4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Target Amount',
                            data: targetData,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            borderDash: [6, 3],
                            fill: false,
                            tension: 0,
                            pointRadius: 0,
                            pointHoverRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Goal: ${goal.title}`,
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#1f2937'
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'line',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Time Progress',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                }
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Amount ($)',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                color: '#374151'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                },
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            },
                            beginAtZero: true
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    },
                    elements: {
                        line: {
                            tension: 0.4
                        }
                    }
                }
            });
        }

        // Reset all data
        async function resetAllData() {
            if (confirm('Are you sure you want to reset all goals and streaks? This action cannot be undone.')) {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/reset`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        alert(result.message);
                        
                        // Reload the dashboard to show empty state
                        loadGoals();
                        loadStreaks();
                        loadDashboard();
                    } else {
                        alert('Error resetting data. Please try again.');
                    }
                } catch (error) {
                    console.error('Error resetting data:', error);
                    alert('Error resetting data. Please try again.');
                }
            }
        }


        // Show spending visualization
        function showSpendingVisualization() {
            showPage('analytics');
        }

        // Goal form submission (old modal - not used anymore)
        document.getElementById('goalForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const goalData = {
                title: document.getElementById('oldGoalTitle').value,
                description: document.getElementById('oldGoalDescription').value,
                target_amount: parseFloat(document.getElementById('oldGoalAmount').value),
                target_date: document.getElementById('oldGoalDate').value + 'T00:00:00Z',
                category: document.getElementById('oldGoalCategory').value,
                priority: 'medium'
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/goals`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(goalData)
                });
                
                if (response.ok) {
                    hideGoalModal();
                    loadGoals(); // Reload goals
                    // Reset form
                    document.getElementById('goalForm').reset();
                } else {
                    alert('Error creating goal. Please try again.');
                }
            } catch (error) {
                console.error('Error creating goal:', error);
                alert('Error creating goal. Please try again.');
            }
        });
        
        // Old login function removed - using new async login function above
        
        // Update analytics metrics with real data
        function updateAnalyticsMetrics(analytics, transactions) {
            try {
                console.log('📊 Updating analytics metrics with real data');
                
                // Update total spending
                const totalSpending = analytics.financial_summary?.total_spent_6_months || 0;
                const totalSpendingElement = document.getElementById('analytics-total-spending');
                if (totalSpendingElement) {
                    totalSpendingElement.textContent = `$${totalSpending.toFixed(2)}`;
                }
                
                // Update savings rate
                const savingsRate = parseFloat(analytics.financial_summary?.savings_rate) || 0;
                const savingsRateElement = document.getElementById('analytics-savings-rate');
                if (savingsRateElement) {
                    savingsRateElement.textContent = `${savingsRate.toFixed(1)}%`;
                }
                
                // Update top category
                const categories = analytics.categories || {};
                const topCategory = Object.keys(categories).reduce((a, b) => categories[a] > categories[b] ? a : b, 'None');
                const topCategoryElement = document.getElementById('analytics-top-category');
                if (topCategoryElement) {
                    topCategoryElement.textContent = topCategory.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                }
                
                // Update goals progress
                const goalsProgress = analytics.goals_summary?.overall_progress || 0;
                const goalsProgressElement = document.getElementById('analytics-goals-progress');
                if (goalsProgressElement) {
                    goalsProgressElement.textContent = `${parseFloat(goalsProgress).toFixed(0)}%`;
                }
                
                // Update monthly trends
                const monthlyIncome = analytics.financial_summary?.monthly_income || 0;
                const monthlyExpenses = analytics.financial_summary?.monthly_expenses || 0;
                const monthlySavings = monthlyIncome - monthlyExpenses;
                
                const trendIncomeElement = document.getElementById('trend-income');
                if (trendIncomeElement) {
                    trendIncomeElement.textContent = `+$${monthlyIncome.toFixed(2)}`;
                }
                
                const trendExpensesElement = document.getElementById('trend-expenses');
                if (trendExpensesElement) {
                    trendExpensesElement.textContent = `-$${monthlyExpenses.toFixed(2)}`;
                }
                
                const trendSavingsElement = document.getElementById('trend-savings');
                if (trendSavingsElement) {
                    trendSavingsElement.textContent = `+$${monthlySavings.toFixed(2)}`;
                }
                
                console.log('✅ Analytics metrics updated successfully');
            } catch (error) {
                console.error('💥 Error updating analytics metrics:', error);
            }
        }
        
        // Analytics functionality
        async function loadAnalytics() {
            try {
                console.log('📊 Loading analytics data for user:', currentUser?.name || 'Unknown');
                
                // Fetch real data from API
                const [transactionsResponse, analyticsResponse] = await Promise.all([
                    fetch(`${API_BASE_URL}/api/transactions`),
                    fetch(`${API_BASE_URL}/api/analytics/dashboard-data`)
                ]);
                
                console.log('📡 Analytics API responses:', {
                    transactions: transactionsResponse.status,
                    analytics: analyticsResponse.status
                });
                
                if (!transactionsResponse.ok || !analyticsResponse.ok) {
                    throw new Error(`API error: transactions=${transactionsResponse.status}, analytics=${analyticsResponse.status}`);
                }
                
                const transactions = await transactionsResponse.json();
                const analytics = await analyticsResponse.json();
                
                console.log('📊 Analytics data received:', {
                    transactions: transactions.length,
                    analytics: analytics
                });
                
                // Create spending chart with real data
                const spendingCtx = document.getElementById('spendingChart');
                if (spendingCtx) {
                    // Destroy existing chart if it exists
                    if (window.spendingChart && typeof window.spendingChart.destroy === 'function') {
                        window.spendingChart.destroy();
                    }
                    
                    const categories = analytics.categories || {};
                    const labels = Object.keys(categories);
                    const data = Object.values(categories);
                    
                    window.spendingChart = new Chart(spendingCtx, {
                        type: 'doughnut',
                        data: {
                            labels: labels.map(cat => cat.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())),
                            datasets: [{
                                data: data,
                                backgroundColor: [
                                    '#16a34a', '#ca8a04', '#22c55e', '#3b82f6',
                                    '#8b5cf6', '#ef4444', '#f59e0b', '#6b7280',
                                    '#ec4899', '#14b8a6', '#f97316', '#6366f1'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
                
                // Create trend chart with real monthly data
                const trendCtx = document.getElementById('trendChart');
                if (trendCtx) {
                    // Destroy existing chart if it exists
                    if (window.trendChart && typeof window.trendChart.destroy === 'function') {
                        window.trendChart.destroy();
                    }
                    
                    const monthlyTrends = analytics.monthly_trends || {};
                    const months = Object.keys(monthlyTrends).sort();
                    const incomeData = months.map(month => monthlyTrends[month].income || 0);
                    const expenseData = months.map(month => monthlyTrends[month].expenses || 0);
                    
                    window.trendChart = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: months.map(month => {
                                const date = new Date(month + '-01');
                                return date.toLocaleDateString('en-US', { month: 'short' });
                            }),
                            datasets: [{
                                label: 'Income',
                                data: incomeData,
                                borderColor: '#16a34a',
                                backgroundColor: 'rgba(22, 163, 74, 0.1)',
                                tension: 0.4,
                                fill: true
                            }, {
                                label: 'Expenses',
                                data: expenseData,
                                borderColor: '#dc2626',
                                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value.toFixed(0);
                                        }
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Update analytics summary cards
                updateAnalyticsSummary(analytics);
                
                // Load AI recommendations with real data
                generateRecommendations(analytics);
                
                // Update analytics metrics with real data
                updateAnalyticsMetrics(analytics, transactions);
                
            } catch (error) {
                console.error('Error loading analytics:', error);
                // Fallback to static data if API fails
                loadStaticAnalytics();
            }
        }
        
        function updateAnalyticsSummary(analytics) {
            // Update financial summary cards
            const totalIncomeElement = document.getElementById('totalIncomeAnalytics');
            const totalExpensesElement = document.getElementById('totalExpensesAnalytics');
            const netAmountElement = document.getElementById('netAmountAnalytics');
            const savingsRateElement = document.getElementById('savingsRateAnalytics');
            
            if (totalIncomeElement) totalIncomeElement.textContent = `$${analytics.financial_summary.total_income_30_days.toFixed(2)}`;
            if (totalExpensesElement) totalExpensesElement.textContent = `$${analytics.financial_summary.total_spent_30_days.toFixed(2)}`;
            if (netAmountElement) {
                netAmountElement.textContent = `$${analytics.financial_summary.net_amount.toFixed(2)}`;
                netAmountElement.className = `text-2xl font-bold ${analytics.financial_summary.net_amount >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            if (savingsRateElement) savingsRateElement.textContent = `${analytics.financial_summary.savings_rate}%`;
        }
        
        function loadStaticAnalytics() {
            // Fallback static analytics if API fails
            const spendingCtx = document.getElementById('spendingChart');
            if (spendingCtx) {
                // Destroy existing chart if it exists
                if (window.spendingChart && typeof window.spendingChart.destroy === 'function') {
                    window.spendingChart.destroy();
                }
                
                window.spendingChart = new Chart(spendingCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Food & Dining', 'Subscriptions', 'Movies', 'Cab', 'Shopping', 'Grocery', 'Travel', 'Misc'],
                        datasets: [{
                            data: [300, 80, 60, 120, 200, 250, 150, 40],
                            backgroundColor: [
                                '#16a34a', '#ca8a04', '#22c55e', '#3b82f6',
                                '#8b5cf6', '#ef4444', '#f59e0b', '#6b7280'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                // Destroy existing chart if it exists
                if (window.trendChart && typeof window.trendChart.destroy === 'function') {
                    window.trendChart.destroy();
                }
                
                window.trendChart = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Income',
                            data: [1500, 1500, 1500, 1500, 1500, 1500],
                            borderColor: '#16a34a',
                            backgroundColor: 'rgba(22, 163, 74, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Expenses',
                            data: [1200, 1250, 1180, 1200, 1220, 1200],
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }
        }
        
        // AI-powered financial product recommendations
        function generateRecommendations(analytics = null) {
            // Use real data if available, otherwise fallback to static data
            const spendingData = analytics && analytics.categories ? 
                analytics.categories : {
                    'food_dining': 450,
                    'transportation': 320,
                    'entertainment': 180,
                    'utilities': 150,
                    'shopping': 200
                };
            
            const topCategory = Object.keys(spendingData).reduce((a, b) => 
                spendingData[a] > spendingData[b] ? a : b
            );
            
            const recommendations = getRecommendationsByCategory(topCategory);
            
            const container = document.getElementById('aiRecommendations');
            if (container) {
                container.innerHTML = recommendations.map(rec => `
                    <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center">
                                <div class="w-8 h-8 ${rec.iconBg} rounded-lg flex items-center justify-center mr-3">
                                    <span class="${rec.iconColor} text-sm">${rec.icon}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 text-sm">${rec.title}</h3>
                                    <p class="text-xs text-gray-500">${rec.category}</p>
                                </div>
                            </div>
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">${rec.savings}</span>
                        </div>
                        <p class="text-xs text-gray-600 mb-3">${rec.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">${rec.provider}</span>
                            <button class="text-xs bg-primary-600 text-white px-3 py-1 rounded hover:bg-primary-700">
                                Learn More
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function getRecommendationsByCategory(category) {
            const recommendations = {
                'Food & Dining': [
                    {
                        title: 'Chase Sapphire Preferred',
                        category: 'Travel & Dining',
                        icon: '💳',
                        iconBg: 'bg-blue-100',
                        iconColor: 'text-blue-600',
                        savings: '3x Points',
                        description: 'Earn 3x points on dining and travel. Perfect for your high dining expenses.',
                        provider: 'Chase'
                    },
                    {
                        title: 'American Express Gold',
                        category: 'Dining Rewards',
                        icon: '🍽️',
                        iconBg: 'bg-yellow-100',
                        iconColor: 'text-yellow-600',
                        savings: '4x Points',
                        description: '4x points on dining worldwide. $120 dining credit annually.',
                        provider: 'Amex'
                    },
                    {
                        title: 'Uber Visa',
                        category: 'Dining & Transportation',
                        icon: '🚗',
                        iconBg: 'bg-green-100',
                        iconColor: 'text-green-600',
                        savings: '4% Cashback',
                        description: '4% cashback on dining, 3% on travel. No annual fee.',
                        provider: 'Barclays'
                    }
                ],
                'Transportation': [
                    {
                        title: 'Chase Sapphire Reserve',
                        category: 'Travel & Transportation',
                        icon: '✈️',
                        iconBg: 'bg-purple-100',
                        iconColor: 'text-purple-600',
                        savings: '3x Points',
                        description: '3x points on travel and dining. $300 travel credit annually.',
                        provider: 'Chase'
                    },
                    {
                        title: 'Capital One Venture',
                        category: 'Travel Rewards',
                        icon: '🌍',
                        iconBg: 'bg-blue-100',
                        iconColor: 'text-blue-600',
                        savings: '2x Miles',
                        description: '2x miles on every purchase. 75,000 bonus miles offer.',
                        provider: 'Capital One'
                    },
                    {
                        title: 'Citi Premier',
                        category: 'Travel & Gas',
                        icon: '⛽',
                        iconBg: 'bg-orange-100',
                        iconColor: 'text-orange-600',
                        savings: '3x Points',
                        description: '3x points on travel, gas, and dining. $100 hotel credit.',
                        provider: 'Citi'
                    }
                ],
                'Entertainment': [
                    {
                        title: 'Capital One Savor',
                        category: 'Entertainment & Dining',
                        icon: '🎬',
                        iconBg: 'bg-red-100',
                        iconColor: 'text-red-600',
                        savings: '4% Cashback',
                        description: '4% cashback on dining and entertainment. No annual fee.',
                        provider: 'Capital One'
                    },
                    {
                        title: 'Chase Freedom Flex',
                        category: 'Rotating Categories',
                        icon: '🎭',
                        iconBg: 'bg-green-100',
                        iconColor: 'text-green-600',
                        savings: '5% Cashback',
                        description: '5% cashback on rotating categories including entertainment.',
                        provider: 'Chase'
                    }
                ]
            };
            
            return recommendations[category] || recommendations['Food & Dining'];
        }
        
        // Simulation functionality
        function initializeSimulations() {
            // Update slider values
            document.getElementById('incomeSlider').addEventListener('input', function() {
                document.getElementById('incomeValue').textContent = '$' + this.value;
            });
            
            document.getElementById('expenseSlider').addEventListener('input', function() {
                document.getElementById('expenseValue').textContent = '$' + this.value;
            });
            
            document.getElementById('returnSlider').addEventListener('input', function() {
                document.getElementById('returnValue').textContent = this.value + '%';
            });
        }
        
        function runSimulation() {
            const incomeChange = parseInt(document.getElementById('incomeSlider').value);
            const expenseChange = parseInt(document.getElementById('expenseSlider').value);
            const returnRate = parseInt(document.getElementById('returnSlider').value);
            
            const currentIncome = 4200;
            const currentExpenses = 2850;
            const currentSavings = currentIncome - currentExpenses;
            
            const newIncome = currentIncome + incomeChange;
            const newExpenses = currentExpenses + expenseChange;
            const newSavings = newIncome - newExpenses;
            
            const results = `
                <div class="space-y-4">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="font-semibold text-green-900 mb-2">💰 Monthly Impact</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">New Income:</span>
                                <span class="font-medium text-green-600">$${newIncome.toLocaleString()}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">New Expenses:</span>
                                <span class="font-medium text-red-600">$${newExpenses.toLocaleString()}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Monthly Savings:</span>
                                <span class="font-medium text-primary-600">$${newSavings.toLocaleString()}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Change:</span>
                                <span class="font-medium ${newSavings > currentSavings ? 'text-green-600' : 'text-red-600'}">
                                    ${newSavings > currentSavings ? '+' : ''}$${(newSavings - currentSavings).toLocaleString()}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-900 mb-2">📈 5-Year Projection</h3>
                        <div class="text-sm">
                            <div class="flex justify-between mb-2">
                                <span>Total Savings:</span>
                                <span class="font-medium">$${(newSavings * 60).toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span>With ${returnRate}% Investment:</span>
                                <span class="font-medium">$${calculateFutureValue(newSavings, returnRate, 5).toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('simulationResults').innerHTML = results;
        }
        
        function calculateFutureValue(monthlyContribution, annualRate, years) {
            const monthlyRate = annualRate / 100 / 12;
            const months = years * 12;
            return monthlyContribution * ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate);
        }
        
        function loadScenario(scenario) {
            const scenarios = {
                promotion: {
                    income: 700,
                    expense: 0,
                    return: 7
                },
                emergency: {
                    income: 0,
                    expense: -200,
                    return: 3
                },
                retirement: {
                    income: 500,
                    expense: -100,
                    return: 8
                }
            };
            
            const s = scenarios[scenario];
            document.getElementById('incomeSlider').value = s.income;
            document.getElementById('expenseSlider').value = s.expense;
            document.getElementById('returnSlider').value = s.return;
            
            document.getElementById('incomeValue').textContent = '$' + s.income;
            document.getElementById('expenseValue').textContent = '$' + s.expense;
            document.getElementById('returnValue').textContent = s.return + '%';
            
            runSimulation();
        }
        
        // Initialize with login page
        document.addEventListener('DOMContentLoaded', async function() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                const isAuthenticated = await checkAuth();
                if (isAuthenticated) {
                    showPage('dashboard');
                    loadDashboard();
                } else {
                    showPage('login');
                }
            } else {
                showPage('login');
            }
            
            // Add fallback event listener for login form
            const loginForm = document.getElementById('loginForm');
            console.log('🔍 Looking for login form:', loginForm);
            if (loginForm) {
                console.log('✅ Login form found, adding event listener');
                loginForm.addEventListener('submit', handleLogin);
            } else {
                console.error('❌ Login form not found!');
            }
            
            // Add event listener for new account form
            const newAccountForm = document.getElementById('newAccountForm');
            console.log('🔍 Looking for new account form:', newAccountForm);
            if (newAccountForm) {
                console.log('✅ New account form found, adding event listener');
                newAccountForm.addEventListener('submit', handleNewAccount);
            } else {
                console.error('❌ New account form not found!');
            }
        });
    </script>
</body>
</html>
